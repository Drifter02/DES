# DES
![DES](/DES.png)

DES加密算法使用了密码的两个原则：混淆和扩散

 混淆：尽可能的复杂化密文的统计特性和密钥的取值之间的关联。使密文和明文及密钥间的关系难以被人分析清楚。

 扩散：让每一位的明文尽可能的影响到更多的密文位，使得每一位明文的变换都会影响到尽可能多位的密文，以增加密码分析的复杂性。

## 实现步骤

主要分为以下几个步骤

1. IP置换
2. 密钥置换
3. S盒代换
4. P盒置换

### IP置换

根据**IP置换表**里面的序号，将明文的相应位置的bit放在序号对应的位置，例如，

``` c
IP_table[0] = 58
则置换后的字符串的第一个bit是原来的第58个bit
```

C语言实现

### 密钥置换

根据输入的密钥生成接下来16轮迭代所用到的子密钥。

1. 密钥压缩

   首先将密钥通过第一个**密钥置换表**。密钥置换表只有56的大小，所以置换后的密钥只有56位，仔细观察可以发现每个字符的第八位都被舍弃了。

2. 子密钥生成

   通过这56位压缩后的密钥产生不同的48位子密钥。然后分成前28位和后28位，分别进行左移，位数按照密钥移位表Move_Table所示，第一轮均左移1位，第三轮左移2位。由于移位的位数不同，所以子密钥必然也不同

3. 压缩子密钥得到最终的子密钥

   最后进行压缩置换，用压缩置换表Compress_Table得到每轮的48位密钥。

所以实现的时候将上诉步骤得到的密钥放在一个`subkey[16][48]`的数组里面。

### 加密细节

前面的处理产生了子密钥，但是还需要做以下处理

1. 拓展置换

   Ri与密钥进行了异或的操作。每个子密钥是48位，Ri为64位的一半即32位，因而需要使用**扩展置换表**扩展为48位。

2. S盒置换

   S盒是将子密钥与分组扩展进行异或后，48位结果分为8组，将每组6位代换为每组4位的过程。8组对应了**8个S盒**，S盒为4行8列，每个位置是一个4位的数。6位的第1位和最后1位决定S盒的第几行，中间4位决定是第几列，找到对应的4位的数进行代换。

   其实就是将48的结果再压缩成32位进行下一轮处理

3. P盒置换

   将S盒出来的32位通**过P盒置换表**进行置换，改变顺序。然后与64最初分组的左半部分异或，左右半部交换，开始新的一轮。总共进行16轮。

4. 末置换

   是初始置换的逆过程。在DES加密第16轮，最后左半部分和右半部分就不进行交换了，而是一起作为末置换的输入。所得即为密文

### 加密

对以上函数的综合，详细信息看源码

### 解密

加密的逆过程，在求解L(i-1)时需要用到以下公式

``` c++
a = b ^ c  ==>  b = a^c
```

### 总结

一开始明文要进行异或操作

子密钥生成是一个独立的过程，这里有个压缩过程

加密中需要用到拓展、压缩过程

所以！！！ 需要很多表，比AES还麻烦，有兴趣可以看一下我仓库里AES的实现讲解。